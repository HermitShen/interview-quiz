Tags:

#golang 



# Шардирование
 
## Что это такое?
 
Шардирование - это **разделение одной БД на несколько отдельных БД**

В зависимости от способа шардирования, таблицы в этих БД будут **разными**

Не обязательно будут задеты все таблицы, некоторые могут не шардироваться
 

Шардирование бывает **горизонтальное и вертикальное**

 
## Горизонтальное шардирование
 
 В шардировании мы делим всю нашу таблицу на **шарды** - одинаковые по размеру части прошлой таблицы
 
 Было - стало
 
 ![[Screenshot From 2025-10-22 18-20-09.png|300]]
 ![[Screenshot From 2025-10-22 18-20-25.png|600]]
 
 



 
 Шардов может быть неограниченное кол-во
 
 Когда приходит новая запись, она попадает в один из шардов по такому же правилу, как и у мапы - через хэш-функцию
 
 ![[Screenshot From 2025-10-22 18-26-42.png]]
 
 

У горизонтально шардирования есть пара нюансов:

- Мы должны правильно выбирать ключ шардирования, чтобы **данные равновемрно распределялись по шардам** и чтобы **избегать мультишардовых запросов**

- Решардинг - добавление новых шардов к существующим

- Сложность в реализации
  
	![[Screenshot From 2025-10-22 18-59-40.png|600]]
 
 
Если заранее не оптимизировать процесс решардинга, нам придется пересчитывать все хеши и номера шардов на ходу

Записи могут переноситься на новые шарды, если старый номер больше не равен текущему

И в течение всего процесса переноса наша система будет простаивать

 
 
Для оптимизации решардинга используются **виртуальные бакеты**

Это когда мы заранее поделилил наши таблицы по шардам

После переполнения записей до опред. отметки - обычно когда БД начинает тормозить - **часть шардов просто переносится в другую БД**, без пересчета хешей и номеров

 
Было - стало:

![[Screenshot From 2025-10-22 18-54-22.png|600]]

![[Screenshot From 2025-10-22 18-54-30.png|600]]
 
 
## Вертикальное шардирование
 
В вертикальном шардировании мы делим таблицы **не по кол-ву записей, а по столбцам**

Столбцы выбираются по общему смыслу

 
Было - стало:

![[Screenshot From 2025-10-22 19-09-15.png|600]]

||
v

![[Screenshot From 2025-10-22 19-09-51.png]]
 
> [!note] 
> Вертикальное шардирование можно сочетать с горизонтальным 
 

