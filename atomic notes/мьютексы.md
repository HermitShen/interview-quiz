Tags: [[для собеседований]]

#golang 



## Мьютексы



1. Устройство мьютекса

	Работа мьютексов основа на достижении нескольких гарантий
	
	![[Screenshot From 2025-10-12 20-46-14 1.png]]
	
	
	Для первой гарантии используются атомарные операции, которые исключат переупорядочевание кода, чтобы инструкции в **критической секции** не вышли за ее пределы
	
	
	Вторая гарантия обеспечивается тем, что **мьютекс может заблокировать только единственная горутина**
	
	 
	
	Как в общем виде (без оптимизаций) выглядит реализация рантайма мьютексов:
	
	```go
	type myMutex struct {  
	    locked int32  
	}  
	  
	func (mu *myMutex) Lock() {  
	    for {  
	       if atomic.CompareAndSwapInt32(&mu.locked, 0, 1) {  
	          return  
	       }  
	    }
	}  
	  
	func (mu *myMutex) Unlock() {  
	    atomic.StoreInt32(&mu.locked, 0)  
	}
	```
	
	Здесь метод `Lock()` крутит бесконечный цикл с CAS; он проверяет занятость мьютекса, и если он не занят(`locked == 0`), то горутина ставить статус 1 
	
	После этого новые горутины будут ждать, пока статус locked снова не выставится в `0`
	
	`Unlock()` просто сбрасывает статус в `0` 


---


## Related


