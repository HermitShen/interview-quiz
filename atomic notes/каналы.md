Tags: [[для собеседований]]

#golang 



## Каналы



1. Как устроен канал?

	В рантайме канал (и с буфером, и без) выглядит так:
	
	![[Screenshot From 2025-10-12 23-53-05.png]]
	
	Т.е. любая переменная типа `chan` - это ссылка на эту структуру
	
	И у каждого канала своя копия
	
	
	
	Каждый из полей по-порядку: 
	
	- `closed` - атомарный флаг - закрыт или открыт канал
	  
		Флаг `closed` выбран не `bool`, потому что атомики не могут работать с `bool` параметрами
	
	
	- `recvq`, `sendq` - указатели на связанный список из горутин, которые ожидают чтения или записи
	
	
	- `lock` - мьютекс, нужен для защиты всего вн. состояния канала. Без него операции `send`/`recv`/`close` и конструкция `select` будут работать с гонками.
	
	
	- `buf` - **кольцевой буфер** с семантикой FIFO (т.е. это **очередь**, но после выхода за предельный индекс указатель сбрасывается до нуля)
	  
	  
		С ним связано большинство полей структуры:
		
		`recvx`, `sendx` - это индексы самого буфера для чтения, записи соответственно
		
		После чтения, записи индексы соответствующе будут декрементится/инкрементится
		
		Остальные поля понятны из названия полей структуры


---


2. Как устроен кольцевой буфер?

	Когда буферизированный канал пуст, указатели `recvq` и `sendq` указывают на начальный индекс буфера
	
	
	
	
	
	
	
	


---


## Related


