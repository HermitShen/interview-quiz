Tags: [[для собеседований]]

#golang 



# Паттерны


&emsp;
## Fan-in

&emsp;

Условие выглядит так:

![[Screenshot From 2025-10-16 01-57-39.png]]

&emsp;

От нас хотят реализовать **один воркер**, который будет читать из **нескольких каналов**

Это часть большого паттерна **Fan-out, fan-in**

&emsp;

В идеале нужно укладываться **менее чем за 10 минут**

&emsp;

Возможная реализация ф-ии

```go
func fanIn(ctx context.Context, chans ...chan int) <-chan int {  
	out := make(chan int)  
  
	go func() {  
	   wg := sync.WaitGroup{}  
	   for _, ch := range chans {  
		  wg.Add(1)  
		  go func() {  
			 defer wg.Done()  
			 for {  
				select {  
				case v, ok := <-ch:  
				   if !ok {  
					  return  
				   }  
				   select {  
				   case out <- v:  
				   case <-ctx.Done():  
					  return  
				   }  
				case <-ctx.Done():  
				   return  
				}  
			 }          
		}()       
	}       
		wg.Wait()  
		close(out)  
	}()  
	
	return out  
}
```

Здесь был добавлен контекст с таймаутом, если попросят на собесе

&emsp;

Нюансы:

- Мы создаем канал `out` **двунаправленным**, потмоу что на выходе он автоматически конвертируется в read-only канал

- Если контекст не нужен, замени `select ` на обычный `range` по каналу
  
- Абсолютно весь код оберни в горутину **между созданием и возвратом канала** `out`

&emsp;
## WP


&emsp;


