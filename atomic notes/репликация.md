Tags: [[для собеседований]]

#golang 



# Репликация
 
## Что такое репликация
 
Репликация - это создание **копии** БД

Копия может исопользоваться для различных целей
 

Самый распространенный вариант репликаций - это отношение **Master - Slave**

В master мы пишем данные, а в slave копируем

![[Screenshot From 2025-10-20 12-39-30.png|400]]
  

Реплики бывают **синхронные** и **асинхронные**:

![[Screenshot From 2025-10-20 12-44-21.png]]
 


> [!tip] 
> Если спросят, был ли опыт с репликациями, можно ответить, что не работал 

 
 
## CAP - теорема
 
**CAP-теорема** говорит: в распределённой системе при **сетевом разрыве** (partition, P) нельзя одновременно гарантировать и **сильную согласованность** (C), и **полную доступность** (A). 
 

Во время разрыва приходится выбирать между consistency и availability (**согласованность** и **доступность**)

![[Screenshot From 2025-10-20 15-40-58.png|450]]
![[Screenshot From 2025-10-20 15-41-13.png|450]]
 
Если мы выберем **консистентность**, то данные могут не соотв. тем, что есть в master, т.е. они с некоторой вероятностью будут **невалидными**

Если мы веберем **согласованность**, то мы не будет отдавать **несогласованные** данные -> будет возвращать статус 500
 
> [!caution] 
> На собесе могут спросить вопрос: как связаны CAP-теорема и изоляция транзакций
> 
> **Это не связанные вещи.** Изоляция применима к отдельному инстансу БД, а CAP - теорема - к рапределенной БД 


 
 
## Для чего нужна репликация?
 
В современной практике использовать репликацию для масштабирования нагрузки - это **антипаттерн**

Если у нас read-intensive нагрузка и мало записи - лучше **поставить кэш**
 

Репликацию используют для **отказоустойчивости**

Если master выходит из строя - синхронная реплика становится новым master, а асинхронная реплика - синхронной для нового master

![[Screenshot From 2025-10-20 16-20-50.png|450]]
![[Screenshot From 2025-10-20 16-17-32.png|450]]
 

А дальше бывший инстанс master заменяется асинхронным slave

![[Screenshot From 2025-10-20 16-19-55.png|450]]
 
 
Если нагрузки становится так много, что отказывает и master, и оба инстанса slave, то используют **резервирование ресурсов**

Это более высокоуровневая репликация, в которой мы копируем не столько один инстанс БД, сколько **весь контур со всеми репликами**
 

Все копии, каждая из которых сама по себе держит работу приложения на себе,  размещаются в своих дата-центрах

![[Screenshot From 2025-10-20 16-30-02.png]]
 
 
## Физическая и логическая репликация
 
При физич. репликации мы поблочно копируем сырые данные с диска на диск

Плюсы и минусы:

![[Screenshot From 2025-10-22 17-50-12.png]]