Tags:[[для собеседований]]

#golang 



# Индексы
 
## Что такое индексы
 
Индексы - это отдельная **структура данных**, которая хранит информацию в удобном для поиска виде
 

Индексы **хранят копию данных** из таблиц, по которым они был созданы

Из-за накладного расхода памяти и времени на поддержание структур индексы **замедляют запись и расходую память**

![[Screenshot From 2025-10-23 02-16-08.png|600]]
 

Конкретно для PostgreSQL индексы хранят ссылки на адреса записей, ими будут пары значений:
*(page number, номер строки)*

![[Screenshot From 2025-10-23 02-20-17.png|600]]
 
 
Есть разные индексы, и все они **ускоряют поиск по таблице для некоторых операций**, в зависимости от типа индекса

Например, самый простой индекс - hash - ускоряет поиск для операции сравнения

Верхнеуровнего он выглядит примерно как мапа, которая за константное время возвращает номер записи в таблице по опред. стоблцу

![[Screenshot From 2025-10-23 02-08-00.png|700]]
 

> [!important] 
> Без индексов мы бы перебирали каждую строку в поиске нужной записи, т.е. делали бы *sequential scanning* 
 
 
## B-tree
 
*B - tree* - это **самый популярный** индекс в продакшене, который ускоряет поиск для самых популрных операций, например:

- `{sql}=, <>`
- `{sql}IN, BETWEEN`
- `{sql}col LIKE 'foo%'`

 
 
В B-tree индексе **все значения сортируются** перед копированием столбца в отдельную структуру

Структура представляет собой *сбалансированное дерево* - спец. подвид графа
 
 

*Корень дерева* - это корневой узел, в который помещаются **разделяющие ключи и ссылки на потомков**

Когда мы ищем запись, мы будем проходить по *веткам дерева* через *ноды* - такие же узлы, как и корень, но с более точечным делением записей

В конце мы придем к одному из *листьев* - конечным нодам дерева, которые уже **хранят сами значения столбца с порядковым номером записи в таблице**

![[Screenshot From 2025-10-23 03-28-06.png|900]]


> [!note] 
> Обычно *глубина* такого дерева не  уходит дальше 4 уровня, даже если записей 1млрд+ 

 
 
Вставка может быть в **свободные** и **заполненные** листы

Если лист свободен, мы просто добавляем данные и сортируем 

Если заполнен, то он **разбивается на пару листов**, для которых **переопределяются новые границы**

![[Screenshot From 2025-10-23 07-42-35.png|900]]
 
 
## Какие индексы еще бывают
 
На интервью можно ограничиться следующими индексами

![[Screenshot From 2025-10-23 07-56-08.png|800]]
 
> [!hint] 
> Если не уверен, ограничься только B-tree индексом, т.к. она самый популярный и его **знает любой интервьюер**
> 
> Если спросят про остальные, говори, что **не работал**  
 
 
## Селективность индексов
 
Индекс хоть и ускоряет поиск, но нужен **не всегда**

На выбор столбца для индекса сильно влияет *селективность индекса* - это **сколько строк вернет `{sql}SELECT`** **из всей выборки записей**

 
По одной таблице возвращается разное число записей:

![[Screenshot From 2025-10-23 08-08-07.png|800]]
 
 
Индекс будет тем **эффективнее**, чем **меньше селективность**

Если **селективность слишком большая**, планировщик БД может выбрать **полное сканирование вместо сканирования по индексу**

![[Screenshot From 2025-10-23 08-11-47.png|800]]
 
 
## Составной индекс
 
dasd